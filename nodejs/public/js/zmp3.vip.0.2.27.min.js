function getActionTracking(a){return zmp3Vip.isBuyCode?"BUY_CODE":"BUY_VIP"}function getParameterByName(a,e){e||(e=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),t=n.exec(e);return t&&t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):""}var gaTracking=function(a,e,n,t){"undefined"!=typeof ga&&ga("mp3.send","event",{eventCategory:a,eventAction:e,eventLabel:n+" "+t})},CATEGORY_TRACKING="MP3_VIP",zmp3Vip={API_VIP_URL:MP3.API_VIP_URL,BANKING_PAY_CREATE_ORDER_URL:"/123pay/create-order",BAKING_PAY_CREATE_ORDER_MULTI_CODE_URL:"/123pay/multicode/create-order",DIRECT_BILLING_CREATE_ORDER_URL:"/direct-billing/create-order",ZALO_PAY_CREATE_ORDER_URL:"/zalopay/create-order",ZALO_PAY_WEB_MOBILE_CREATE_ORDER_URL:"/zalopay/wap/create-order",ZALO_PAY_CHECK_STATUS_URL:"/zalopay/get-status",CODE_SUBMIT_URL:"/code-vip/submit-code",ZALO_ID_URL:"https://id.zalo.me/account",ZALO_LOGIN_URL:"https://id.zalo.me/account?continue="+MP3.MP3_VIP_URL,PRODUCT_TYPE:1,PLATFORM:1,isBuyCode:!1,buyCode:function(){zmp3Vip.isBuyCode=!0,zmp3Vip.buyVip(!0),zmp3Vip.isBuyCode=!0},buyVip:function(a){if(gaTracking(CATEGORY_TRACKING,getActionTracking(a),"",""),$(".modal").modal("hide"),$(".layer-loading").removeClass("hidden"),parseInt(MP3.ACCOUNT_ID)<1)return window.location=zmp3Vip.ZALO_LOGIN_URL+(a?"?isBuyCode=1":""),setTimeout(function(){$(".layer-loading").addClass("hidden")},2e3),!1;zmp3Vip.isBuyCode=!1,$(".layer-loading").addClass("hidden"),zmp3BankingPay.step1(a)},showMessage:function(a,e,n){0==e?$(a+" .message").html('<i class="ic ic-success" style="margin-right: 5px;"></i>'+n):$(a+" .message").html('<i class="ic ic-alert" style="margin-right: 5px;"></i>'+n)}},removeTag=function(a){return a.replace(/<([^ >]+)[^>]*>.*?<\/\1>|<[^\/]+\/>/gi,"")},zmp3Number={format:function(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1,$2");return x1+x2}},zmp3Date={format:function(a){return j=new Date(1e3*a),this.fill2(j.getDate())+"/"+this.fill2(j.getMonth()+1)+"/"+j.getFullYear()},fill2:function(a){return a<10?"0"+a:a}},zmp3String={trim:function(a){return a.replace(/\s+/g,"")},numberWithDot:function(a){return a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}},zmp3DateTime={format:function(a){j=new Date(1e3*a);var e=j.getHours(),n=this.fill2(j.getMinutes());return e+":"+n+" "+this.fill2(j.getDate())+"/"+this.fill2(j.getMonth()+1)+"/"+j.getFullYear()},fill2:function(a){return a<10?"0"+a:a}},isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isZalo=/Zalo/i.test(navigator.userAgent);isZalo&&($(".fn-login").hide(),$(".fn-login").removeClass("show-on-small"),$(".require-login-zalo").hide(),setTimeout(function(){$.ajax({url:"/xhr/user/get-profile",type:"GET",dataType:"json",success:function(a){if(a.data&&!(a.data.userid<1)){MP3.ACCOUNT_ID=a.data.userid,MP3.ACCOUNT_NAME=a.data.username,MP3.DISPLAY_NAME=a.data.displayname;var e='<span class="avatar avatar--s" style="background-image:url('+a.data.avatar+');"></span>';e+="<span>"+a.data.displayname+"</span>",$(".user-profile").html(e),$(".menu-user .user").html(e)}},error:function(a,e){console.log("err ",a)}})},2e3));var isUsing3G=function(a){return!(!a.viettel||1!=a.viettel)||(!(!a.mobiphone||1!=a.mobiphone)||!(!a.vinaphone||1!=a.vinaphone))},timeOut=null,interval=null,zmp3BankingPay={amount:0,month:0,bank:"",formid:"#form-payment-bank",counter:1,isUsing3G:!1,init:function(){$(".fn-submitbank").click(function(a){zmp3BankingPay.step3($(this))}),$(".fn-submitCounter").click(function(a){zmp3BankingPay.step2(zmp3BankingPay.month,zmp3BankingPay.amount,!1,!0)}),$(".fn-choose-bank").click(function(a){$(zmp3BankingPay.formid+" ul li").removeClass("active"),$(this).parent("li").addClass("active"),zmp3BankingPay.bank=$(this).data("bank")}),$("#payment-descrese").on("mousedown",function(){var a=zmp3BankingPay.counter-1;a>0&&($("#payment-count").html(a),$("#total-price").html(zmp3String.numberWithDot(a*zmp3BankingPay.amount)+" VNĐ"),zmp3BankingPay.counter=a,timeOut=setTimeout(function(){interval=setInterval(function(){a=zmp3BankingPay.counter-1,a>0&&($("#payment-count").html(a),$("#total-price").html(zmp3String.numberWithDot(a*zmp3BankingPay.amount)+" VNĐ"),zmp3BankingPay.counter=a)},75)},500))}).on("mouseup mouseleave",function(){clearTimeout(timeOut),clearInterval(interval)}),$("#payment-increse").on("mousedown",function(){var a=zmp3BankingPay.counter+1;a<31&&($("#payment-count").html(a),$("#total-price").html(zmp3String.numberWithDot(a*zmp3BankingPay.amount)+" VNĐ"),zmp3BankingPay.counter=a,timeOut=setTimeout(function(){interval=setInterval(function(){a=zmp3BankingPay.counter+1,a<31&&($("#payment-count").html(a),$("#total-price").html(zmp3String.numberWithDot(a*zmp3BankingPay.amount)+" VNĐ"),zmp3BankingPay.counter=a)},75)},500))}).on("mouseup mouseleave",function(){clearTimeout(timeOut),clearInterval(interval)}),$.ajax({url:"/xhr/user/get-ip",type:"GET",dataType:"json",success:function(a){console.log(a),a.err<0||a.data&&a.data.using3G&&isUsing3G(a.data.using3G)&&(zmp3BankingPay.isUsing3G=!0)}})},step1:function(a){$(zmp3BankingPay.formid+".message").addClass("none"),$(".modal").modal("hide"),$("#modal-payment-internet").modal("show"),$("#modal-payment-internet .title-modal span").text(a?"Chọn gói Code VIP":"Chọn gói VIP"),gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"123 PAY","")},step2:function(a,e,n=!1,t=!1){if($("#modal-payment-bank").removeClass("disable-back"),parseInt(MP3.ACCOUNT_ID)<1)return window.location=zmp3Vip.ZALO_LOGIN_URL+(zmp3Vip.isBuyCode?"%26isBuyCode=1":""),setTimeout(function(){$(".layer-loading").addClass("hidden")},2e3),!1;gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"123 PAY","PACKAGE_VIP"),zmp3BankingPay.isUsing3G&&gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"123 PAY","PACKAGE_VIP_USE_3G"),$(zmp3BankingPay.formid+".message").addClass("none"),zmp3BankingPay.amount=e,zmp3BankingPay.month=a,zmp3Vip.isBuyCode=t;let i={6:"6 tháng",12:"1 năm",24:"2 năm"};$(".title-modal-bank").html("Thẻ ATM có Internet Banking (miễn phí) - Thanh toán gói dịch Zing MP3 VIP "+i[a]+" ("+zmp3Number.format(e)+"đ)"),$(".modal").modal("hide"),$("#modal-payment-bank").modal("show"),n&&$("#modal-payment-bank").addClass("disable-back")},step3:function(a){return zmp3BankingPay.bank?(gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"123 PAY",zmp3BankingPay.bank),zmp3BankingPay.callAPI(a),!1):(zmp3Vip.showMessage(zmp3BankingPay.formid,-1,"Vui lòng chọn ngân hàng cần thanh toán"),alert("Vui lòng chọn ngân hàng cần thanh toán"),!1)},getBankCode:function(a){return"123P"+a.toUpperCase()},stepBuyVip:function(a,e,n=!1){zmp3Vip.isBuyCode?zmp3BankingPay.stepChooseCounter(a,e):zmp3BankingPay.step2(a,e,n)},stepChooseCounter:function(a,e){$(".modal").modal("hide"),$("#modal-payment-count-code").modal("show"),$(".payment-code-content").eq(0).html("Gói VIP "+a+" tháng"),$(".payment-code-price .new-price").html(zmp3String.numberWithDot(e)+" VNĐ"),$("#total-price").html(zmp3String.numberWithDot(e*zmp3BankingPay.counter)+" VNĐ"),zmp3BankingPay.month=a,zmp3BankingPay.amount=e},callAPI:function(a){let e,n;gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"123 PAY","Thanh Toán"),$(a).html("Đang xử lý ..."),a.addClass("disabled"),zmp3Vip.isBuyCode?(e={productType:zmp3Vip.PRODUCT_TYPE,amount:zmp3BankingPay.amount,bankCode:zmp3BankingPay.bank,count:zmp3BankingPay.counter},n=zmp3Vip.API_VIP_URL+zmp3Vip.BAKING_PAY_CREATE_ORDER_MULTI_CODE_URL):(e={productType:zmp3Vip.PRODUCT_TYPE,amount:zmp3BankingPay.amount,bankCode:zmp3BankingPay.bank,isBuyCode:zmp3Vip.isBuyCode},n=zmp3Vip.API_VIP_URL+zmp3Vip.BANKING_PAY_CREATE_ORDER_URL),$.ajax({url:n,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:e,success:function(e){if(0!==parseInt(e.code)||void 0===e.data.redirectUrl)return alert(e.message),a.removeClass("disabled"),$(a).html("Thanh toán"),!1;console.log(e),window.location.href=e.data.redirectUrl,setTimeout(function(){a.removeClass("disabled"),$(a).html("Thanh toán")},5e3)},error:function(a,e){console.log("err ",a)}})}},zmp3ZaloPay={amount:0,formId:"#from-zalopay",intervalStatus:null,intervalTimer:null,transactionId:"",timestamp:0,timerNumnber:300,numberCheckStatus:0,init:function(){},step1:function(){zmp3ZaloPay.zpClearInterval(),$(".modal").modal("hide"),$("#modal-payment-zalopay").modal("show")},step2:function(a){return zmp3ZaloPay.zpClearInterval(),zmp3ZaloPay.amount=a,zmp3ZaloPay.amount<1?(zmp3ZaloPay.step1(),fasle):isMobile?(zmp3ZaloPay.callCreateOrderWebMobile(),!1):($.ajax({url:zmp3Vip.API_VIP_URL+zmp3Vip.ZALO_PAY_CREATE_ORDER_URL,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:{productType:zmp3Vip.PRODUCT_TYPE,amount:zmp3ZaloPay.amount,platform:zmp3Vip.PLATFORM,isBuyCode:zmp3Vip.isBuyCode},success:function(a){if(0!==a.code||!a.data.transId)return zmp3Vip.showMessage("#modal-payment-zalopay",-1,a.message),!1;$(zmp3ZaloPay.formId+" .item-qr img").attr("src","data:image/png;base64,"+a.data.qrcode),zmp3ZaloPay.transactionId=a.data.transId,zmp3ZaloPay.timestamp=a.timestamp,zmp3ZaloPay.step3()},error:function(a,e){console.log("err ",a)}}),!1)},step3:function(){zmp3ZaloPay.zpClearInterval(),$(".modal").modal("hide"),$("#modal-payment2").modal("show"),zmp3ZaloPay.intervalStatus=setInterval(function(){zmp3ZaloPay.checkStatus()},5e3),zmp3ZaloPay.intervalTimer=setInterval(zmp3ZaloPay.updateTimer,1e3)},callCreateOrderWebMobile:function(){$.ajax({url:zmp3Vip.API_VIP_URL+zmp3Vip.ZALO_PAY_WEB_MOBILE_CREATE_ORDER_URL,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:{productType:zmp3Vip.PRODUCT_TYPE,amount:zmp3ZaloPay.amount,platform:zmp3Vip.PLATFORM,isBuyCode:zmp3Vip.isBuyCode},success:function(a){if(0!==a.code||!a.data.transId||!a.data.link)return zmp3Vip.showMessage("#modal-payment-zalopay",-1,a.message),!1;window.location=a.data.link},error:function(a,e){console.log("err ",a)}})},updateTimer:function(){zmp3ZaloPay.timerNumnber<1?zmp3ZaloPay.checkStatus():(--zmp3ZaloPay.timerNumnber,$(".timer span.time-loading").text(zmp3ZaloPay.timerNumnber))},zpClearInterval:function(){clearInterval(zmp3ZaloPay.intervalStatus),clearInterval(zmp3ZaloPay.intervalTimer),zmp3ZaloPay.timerNumnber=300},checkStatus:function(){(zmp3BankingPay.numberCheckStatus>50||zmp3ZaloPay.timerNumnber<1)&&(zmp3ZaloPay.zpClearInterval(),$(zmp3ZaloPay.formId+" .item-qr img").attr("src",MP3.SKIN_URL+"/vip/images/ic_qr.png"),$(zmp3ZaloPay.formId+" .timer span").hide(),$(zmp3ZaloPay.formId+" .timer a").removeClass("none"),zmp3ZaloPay.boxStatus(-1,{})),$.ajax({url:zmp3Vip.API_VIP_URL+zmp3Vip.ZALO_PAY_CHECK_STATUS_URL,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:{transactionId:zmp3ZaloPay.transactionId},success:function(a){if(0!==a.code)return zmp3Vip.showMessage("#modal-payment-zalopay",-1,a.message),!1;zmp3ZaloPay.zpClearInterval(),zmp3ZaloPay.boxStatus(0,a)},error:function(a,e){console.log("err ",a)}}),zmp3ZaloPay.numberCheckStatus++},boxStatus:function(a,e){$(".modal").modal("hide");var n="#modal-payment-unsuccess";0==a&&(n="#modal-payment-success",$(n+" p .time-expire-vip").html(zmp3Date.format(e.data.timeExp))),$(n+" p .userid").html(MP3.ACCOUNT_ID),$(n+" p .transactionid").html(zmp3ZaloPay.transactionId),$(n+" p .time-payment").html(zmp3DateTime.format(zmp3ZaloPay.timestamp)),$(n).modal("show")}},zmp3CardPay={amount:0,code:"",seri:"",card:4,formId:"#form-payment-card",init:function(){$(".fn-choose-card").click(function(a){$(".payment-type--card ul li").removeClass("active"),$(this).parent("li").addClass("active"),zmp3CardPay.card=$(this).data("card")}),$(".fn-submitcard").click(function(a){zmp3CardPay.step3($(this))})},resetForm:function(){$(".payment-type--card ul li").removeClass("active"),$(".payment-type--card ul li:first-child").addClass("active"),$(zmp3CardPay.formId+" .form-input-card").removeClass("has-error"),zmp3CardPay.card=4,$(zmp3CardPay.formId+" .message").html(""),$(zmp3CardPay.formId)[0].reset()},step1:function(){gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD",""),zmp3CardPay.resetForm(),$(".modal").modal("hide"),$("#modal-payment-package-card").modal("show")},step2:function(){gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD","VIP_PACKAGE"),zmp3CardPay.resetForm(),$(".modal").modal("hide"),$("#modal-payment-card").modal("show")},step3:function(a){gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD","INPUT_CARD");var e=zmp3CardPay.formId;return zmp3CardPay.code=removeTag($(e+" .code").val()),zmp3CardPay.seri=removeTag($(e+" .seri").val()),$(e+" .form-input-card").removeClass("has-error"),$(e+" .message").html(""),zmp3CardPay.card<1?($(e+" .message").html("Vui lòng chọn nhà mạng để thanh toán!"),!1):zmp3CardPay.code?zmp3CardPay.seri?(a.addClass("disabled"),zmp3CardPay.callAPI(a),!1):($(e+" .form-seri").addClass("has-error"),$(e+" .form-seri .seri").focus(),!1):($(e+" .form-code").addClass("has-error"),$(e+" .form-code .code").focus(),!1)},callAPI:function(a){gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD","THANH TOÁN"),$(a).html("Đang xử lý ..."),$.ajax({url:zmp3Vip.API_VIP_URL+zmp3Vip.DIRECT_BILLING_CREATE_ORDER_URL,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:{productType:zmp3Vip.PRODUCT_TYPE,networkProvider:zmp3CardPay.card,seriCard:zmp3CardPay.seri,codeCard:zmp3CardPay.code,isBuyCode:zmp3Vip.isBuyCode},success:function(e){if(a.removeClass("disabled"),$(a).html("Thanh toán"),0!==parseInt(e.code))return gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD","THANH TOÁN THẤT BẠI"),zmp3Vip.showMessage(zmp3CardPay.formId,-1,e.message),!1;if(gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"CARD","THANH TOÁN THÀNH CÔNG"),zmp3Vip.isBuyCode){var n=e.data.codeVip?e.data.codeVip:"";if(n){var t='<h5>Bạn vui lòng nhập code dưới đây để nhận VIP hoặc tặng bạn bè. <a href="/vip?codeVip='+n+'#inputCode">Nhập code ngay</a></h5>';t+='<p class="highlight"><span class="label">Mã code gửi bạn bè:</span><span class="ctn-label code">'+n+"</span></p>",t+='<span class="line"></span>',$(zmp3CardPay.formId+" .code-vip-message").html(t)}}else{var i=e.data.timeExp?e.data.timeExp:0;zmp3Vip.showMessage(zmp3CardPay.formId,0,"Giao dịch thành công.Thời hạn VIP đến ngày "+zmp3Date.format(i)+".")}},error:function(a,e){console.log("err ",a)}})}};zmp3CodePay={code:"",formId:"#inputCode",init:function(){$(".fn-submitcode").click(function(a){zmp3CodePay.submitCode($(this))}),$("#inputCode .code").on("keypress change",function(){$(this).val(function(a,e){return/\D/g.test(e)&&(e=this.value.replace(/\D/g,"")),e.replace(/\W/gi,"").replace(/(.{4})/g,"$1 ")})})},submitCode:function(a){if(gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"NAP_CODE",""),zmp3CodePay.code=removeTag($(zmp3CodePay.formId+" .code").val()),!zmp3CodePay.code)return zmp3CodePay.showMessage(-1,"Vui lòng nhâp mã code"),$(zmp3CodePay.formId+" .code").focus(),!1;a.addClass("disabled"),$.ajax({url:zmp3Vip.API_VIP_URL+zmp3Vip.CODE_SUBMIT_URL,type:"GET",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,data:{productType:zmp3Vip.PRODUCT_TYPE,vipcode:zmp3String.trim(zmp3CodePay.code)},success:function(e){if(a.removeClass("disabled"),-11==e.code){var n=confirm("Bạn vui lòng đăng nhập để thực hiện chức năng này.");return n&&(window.location=zmp3Vip.ZALO_ID_URL+"?continue="+MP3.MP3_VIP_URL+"%23inputCode"),!1}if(0!==parseInt(e.code))return gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"NAP_CODE","NẠP CODE THẤT BẠI"),zmp3CodePay.showMessage(-1,e.message),!1;gaTracking(CATEGORY_TRACKING,getActionTracking(zmp3Vip.isBuyCode),"NAP_CODE","NẠP CODE THÀNH CÔNG"),zmp3CodePay.showMessage(0,"Kích hoạt VIP thành công.Thời hạn VIP đến ngày "+zmp3Date.format(e.data.timeExp)+".")},error:function(a,e){console.log("err ",a)}})},showMessage:function(a,e){0==a?$(zmp3CodePay.formId+" .message").html('<i class="ic ic-success"></i>'+e):$(zmp3CodePay.formId+" .message").html('<i class="ic ic-alert"></i>'+e)}},$(document).ready(function(){$(".fn-login").click(function(a){if($(".layer-loading").removeClass("hidden"),parseInt(MP3.ACCOUNT_ID)<1)return window.location=zmp3Vip.ZALO_LOGIN_URL,setTimeout(function(){$(".layer-loading").addClass("hidden")},2e3),!1;$(".layer-loading").addClass("hidden")}),$(".buy-vip").click(function(a){zmp3Vip.buyVip()}),$(".buy-code").click(function(a){zmp3Vip.buyCode()}),$(".func-close").click(function(a){zmp3ZaloPay.zpClearInterval()}),zmp3CardPay.init(),zmp3CodePay.init(),zmp3BankingPay.init(),$(".func-scroll").on("click",function(a){a.preventDefault(),$("html, body").animate({scrollTop:0},500)}),$(".textarea-focus").focus(function(){$(".textarea").addClass("focus")}).blur(function(){$(".textarea").removeClass("focus")}),$(".copy-code").click(function(){var a=$("<input>");$("body").append(a);var e=$.trim($(this).parent().find("span").text()),n=$(this).parent().find("span").get(0);if(!isNaN(e)){var t=window.getSelection(),i=document.createRange();i.selectNodeContents(n),t.removeAllRanges(),t.addRange(i),document.execCommand("copy"),$(this).parent().find("span").text("Đã sao chép"),setTimeout(()=>{$(this).parent().find("span").text(e)},500)}}),$(window).scroll(function(){$(this).scrollTop()>130?$(".header-container.has-fixed").addClass("show"):$(".header-container.has-fixed").removeClass("show")}),$(".collapse-group").on("click",function(a){a.preventDefault(),$(this).toggleClass("active")}),$("#func-more").on("click",function(a){$(".payment-type--zalopay.has-scroll").removeClass("disabled"),$(".has-more").addClass("hidden")})});